<style>
	#newObs_img {
		margin-right: 10px;
	}
	#newObs_title {
		font-size: 20px;
	}
	.span_button {
		margin-left: 20px;
		font-size: 11px;
		padding: 3px 8px;
		float: left;
		background-color: rgb(81,0,77);
		color: white;
	}
	.button_link {
		margin-left: 5px;
		font-weight: bold;
		text-decoration: none;
		color: white !important;
	}
	.span_button > img {
		margin-right: 5px;
	}
	#newObs_title_wrap {
		margin-bottom: 13px;
	}
	span.button_header {
		font-size: 16px;
		padding-right: 5px;
		float: left;
		font-family: Tahoma, Geneva, sans-serif;
	}
	#scrolling_area {
		margin-left: 18%;
		margin-right: 20%;
	}
	.selectedName {
		display: block;
		margin-bottom: 5px;
	}
	#selectedNames {
		clear: both;
		margin-left: 40px;
		font-size: 13px;
	}
	.remove_link {
		font-size: 11px;
		color: rgb(198,141,195) !important;
		margin-left: 7px;
	}
	#stdButton {
		margin-left: 60px;
		margin-top: -2px;
	}
	#expButton {
		margin-top: -2px;
		margin-left: 26px;
	}
	#expList {
		clear: both;
		font-size: 13px;
		margin:0px;
	}
	.selectedExp {
		margin-bottom: 10px;
	}
	#level_type {
		clear: both;
		font-size: 17px;
		margin-top:18px;
	}
	#comments {
		width: 100%;
		clear: both;
		padding-bottom: 10px;
	}
	#comments textarea {
		font-size: 13px;
		font-weight: normal;
		margin-top: 5px;
		width: 100%;
		color: rgb(51,51,51);
		padding: 3px;
		border-style: solid;
		border-width: 1px;
		border-color: rgb(198,141,195);
	}
	#expectation {
		margin-top: 20px;
	}
	#level_type {
		float: left;
		margin-bottom: 20px;
	}
	.activity_types {
		float: left;
		font-size: 17px;
		display: inline;
	}
	#record_types {
		float: left;
		margin-top: 10px;
		margin-bottom: 20px;
	}
	.button_group {
		margin-left: 10px;
		margin-right: 20px;
		margin-top: 10px;
	}
	#remaining_msg {
		font-size: 15px !important;
	}
	#submit {
		text-align: center;
	}
	#newObs_mainEntry {
		margin-left: 30px;
	}
	#remainingChars {
		margin-left: 60px;
	}
	#expectationLabel {
		margin-bottom: 5px;
	}
	#activityTypeLabel {
		margin-top: 26px;
	}
	#workTypeLabel {
		margin-top: 40px;
		margin-left: 30px;
	}
	#levelTypeHeader {
		margin-top: 66px;
	}
	#level_button_group {
		margin-left: 30px;
	}
	#actityTypeContainer {
		margin-top: 18px;
	}
	#addObsButton {
		font-size: 13px;
		font-weight: bold;
		padding: 5px 15px;
		background-color: rgb(81,0,77);
		border-width: 0px;
		color: white;
	}
	#addObsButton:hover {
		cursor: pointer;
	}
	.span_button {
		margin-top: -7px;
	}
	#observation_date {
		float: left;
	}
	#full_wrapper {
		width: 100%;
		height: 30px;
		margin-bottom: 15px;
	}
	#observation_dateField {
		font-size: 13px !important;
		padding-left: 3px;
		color: rgb(102,102,102);
		border-style: solid;
		border-width: 1px;
		border-color: rgb(198,141,195);
	}
	#date_header {
		margin-top: 8px;
	}
	#calendar_show {
		margin-top: 6px;
	}
	#learningLabel{
		margin-bottom: 5px;
	}
	#learningButton{
		margin-top: -2px;
		margin-left: 85px;
	}
	#learning{
		margin-top:15px;
	}
	#learningList{
		clear: both;
		font-size: 13px;
	}

</style>
<link rel="stylesheet" type="text/css" media="all" href="css/jScrollPane.css" />
<script type="text/javascript" src="js/jScrollPane.js"></script>
<div id='newObs_container'>
	<div id='newObs_mainEntry'>
		<div id='newObs_title_wrap'><img id='newObs_img'src ='css/images/conversation_icon.png' width='25' height='25'/><h1 id='newObs_title'style='display:inline'>Edit Conversation</h1>
		</div>
		<div id='scrolling_area'>
			<div id='full_wrapper'>
				<div id='observation_date'>
					<span class='button_header' id='date_header'>Date:</span>
					<input type="text" id='observation_dateField' />
					<img id='calendar_show' src = 'css/images/calender_icon.png' width='18' height='15'/>
				</div>
			</div>
			<span class='button_header'>Students Applied:</span>
			<div id='selectedNames'></div>
			<div id='expectation'>
				<span class='button_header' id='expectationLabel'>Academic Expectation:</span><span id='expButton' class='span_button'><img src ='css/images/add_icon.png' width='11' width='11'/><a id='expLink' class='button_link'href='#'>Select</a></span>
				<ul id='expList'></ul>
			</div>
			<div id='learning'>
				<span class='button_header' id='learningLabel'>Learning Skill:</span><span id='learningButton' class='span_button'><img src ='css/images/add_icon.png' width='11' width='11'/><a id='learningLink' class='button_link'href='#'>Select</a></span>
				<ul id='learningList'></ul>
			</div>
			<div id='level_type'>
				<span class='button_header' id='levelTypeHeader'>Level</span>
				<div class='button_group'  id='level_button_group' style='display:inline; float:left'>
					<a class='up toggle_button' buttongroup = '1' grouptype_id='0'>Insufficient</a>
					<a class='up toggle_button' buttongroup = '1' grouptype_id='1'>Limited</a>
					<a class='up toggle_button' buttongroup = '1' grouptype_id='2'>Approaching</a>
					<a class='up toggle_button' buttongroup = '1' grouptype_id='3'>Sufficient</a>
					<a class='up toggle_button' buttongroup = '1' grouptype_id='4'>Insightful</a>
				</div>
			</div>
			<div id='comments'>
				<div id='comment_about'>
					<span class='button_header'>Comments</span><span id='remainingChars' style='font-size:13px !important'>500</span><span id='remaining_msg' style='font-size:13px !important'> Characters Remaining</span>
				</div>
				<textarea id='comments_area' rows="4"></textarea>
			</div>
		</div>
		<div id='submit'>
			<input type="button" value='submit' id="addObsButton"/>
		</div>
	</div>
</div>
<script type="text/javascript" charset="utf-8">
	var charLimit = 500;
	var charsRemaining = 500;
	var selectedWType = null;
	var addedStudents = {};
	var expectationsAdded = {};
	var skillsAdded = {};
	/*
	 * when this dialog is done loading, the current date is displayed on the dateField
	 */
	$(document).ready(function() {
		$("#observation_dateField").datepicker({
			showOn : "none"
		});
		date = new Date();
		day = date.getDate();
		month = date.getMonth() + 1;
		if(month <= 9)
			month = "0" + month;
		year = date.getFullYear();
		$("#observation_dateField").val(month + "/" + day + "/" + year);
	})
	/*
	 * when calender button is presses, the datepicker is displayed
	 */
	$("#calendar_show").click(function() {
		$("#observation_dateField").datepicker("show");
	})
	/*
	 * when expLink button is pressed, the add_expectation_dialog is loaded
	 */
	$("#expLink").click(function(e) {
		$("#add_container").load('add_expectation_dialog.html?int=' + Math.random());
		$("#add_container").dialog({
			resizable : false,
			modal : true,
			close : function(ev, ui) {
				$(this).html("");
			},
			position : [e.pageX, e.pageY]
		});
	});
	$("#learningLink").click(function(e) {
		$("#add_container").load('add_learning_dialog.html?int=' + Math.random());
		$("#add_container").dialog({
			resizable : false,
			modal : true,
			close : function(ev, ui) {
				$(this).html("");
			},
			position : [e.pageX, e.pageY]
		});
	});
	var studentsAdded = {};
	/*
	 * obtains length of the user comment and compare it to the character limit
	 *
	 * if the length of user comment exceeds the limit,
	 * if the length of user comment exceeds the limit,
	 * only the first 500 characters of the user comment will be shown
	 */
	$("#comments_area").keyup(function() {
		length = $(this).val().length;
		charsRemaining = charLimit - length;
		if(charsRemaining < 0) {
			$("#comments_area").val($(this).val().substring(0, 500));
			charsRemaining = 0;
		}
		$("#remainingChars").html(charsRemaining);
	})
	$('a.toggle_button').click(function() {
		if($(this).attr("grouptype_id") !== undefined) {
			var buttonGroup = $(this).attr("buttongroup");
			if(selectedWType === null) {
				selectedWType = $(this).attr("grouptype_id")
			} else {
				$("a.toggle_button[buttongroup=" + buttonGroup + "]").each(function() {
					if($(this).attr("grouptype_id") !== undefined) {
						$(this).removeClass("down")
						$(this).removeClass("up");
						$(this).addClass("up");
					}
				})
			}
		}
		$(this).toggleClass("up");
		$(this).toggleClass("down");
	});
	/*
	 * removes a selected student or expectation
	 */
	$("a.remove_link").live('click', function() {
		if($(this).attr("link_type") == "std") {
			delete studentsAdded[$(this).parent().attr('id')];
			$(this).parent().remove();
		} else if($(this).attr("link_type") == "exp") {
			//delete studentsAdded[$(this).parent().attr('id')];
			delete expectationsAdded[$(this).parent().attr('id')];
			$(this).parent().parent().remove();
		}
	})
	var finalConv = {};
	//final result of save method
	function save(id) {
		dateInField = $("#observation_dateField").val(); //get date from field
		finalConv.stid = $(".selectedName").attr("id"); //get student id from field 
		finalConv.timestamp = new Date(dateInField) / 1000; ///get date object from date field
		finalConv.expectation = $(".selectedExp").attr("id"); //get expectation id from field
		finalConv.level = $("#level_button_group").find(".down").index(); //get level from button index (0 is the first button, etc)
		finalConv.text = $("#comments_area").val(); //get text from comments area value
		if(finalConv.expectation.indexOf("lrn_") != -1)//if there is lrn_ in the expectation id
		{
			finalConv.flag = 1;
			//lrn means learning skill, so the learning skill flag is on
			finalConv.expectation = finalConv.expectation.substr(4);
			//but lrn_ isn't actually part of the id
		} else
			finalConv.flag = 0;

		params.fcn = "updateRecord";
		params.params = [
			id, //record ID
			finalConv.timestamp, //date
			finalConv.flag, //0 = expectation, 1 = learning skill
			finalConv.expectation, //expectation/learning skill ID
			finalConv.level, //level
			finalConv.text //comments
		];
		if(finalConv.stid != undefined && finalConv.expectation != undefined && dateInField != "" && finalConv.activity != "" && finalConv.activityId != -1 && finalConv.workType != "" && finalConv.workTypeId != -1 && finalConv.level != -1 && finalConv.text != "") {
			jQuery.getJSON(IP + "/mark/model/communications-model.php?callback=?", params, function(data) {
				if(!data[0]) {//standard data transfer and error display
					$("#error_text").html(data[1][0]);
					$("#error_msg").show();
					$("#msg").hide();
				} else {
					$("#dialog").dialog("close"); //close the box when they hit submit
					$("#new_entryMenu").load("getRecords.html");
				}
			});
		}
	}
</script>