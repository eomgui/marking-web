<style>
	.nobgimg_menu {
		background-image: none !important;
		font-size: 12px !important;
		padding: 0px !important;
	}
	.prevRecords_menu {
		padding: 10px 15px !important;
		font-size: 12px !important;
	}
	.smaller_submenuRecord {
		width: 135px !important;
	}
	.smaller_submenuView {
		width: 112px !important;
	}
	#record_top_wrapper {
		display: block;
		font-size: 125%;
		margin-top: 5px;
		margin-left: 30px;
	}
	#record_wrapper {
		width: 100%;
		height: 100px;
	}
	#record_data_fields {
		clear: both;
		overflow-y: scroll;
		overflow-x: hidden;
	}
	.record_data {
		-o-text-overflow: ellipsis;   /* Opera */
		text-overflow: ellipsis;   /* IE, Safari (WebKit) */
		overflow: hidden;              /* don't show excess chars */
		white-space: nowrap;           /* force single line */
		width: 100% !important;                 /* fixed width */
	}
	.record {
		border-bottom-color: rgb(198,141,195);
		border-bottom-style: solid;
		border-bottom-width: 1px;
		padding-left: 15px;
		padding-top: 15px;
		padding-bottom: 15px;
		font-size: 14px;
	}
	#record_data_fields {
		width: 90%;
		margin: 0px auto;
		height: 560px;
	}
	#view_menu {
		padding-left: 25px !important;
		padding-right: 25px !important;
	}
	.record_options {
		width: 20%;
		display: inline-block;
		vertical-align: top;
		font-size: 11px;
	}
	.record_main {
		width: 75%;
		display: inline-block;
	}
	.record_tool_link {
		color: rgb(198,141,195) !important;
	}
	.record_tool_link_wrapper {
		margin-bottom: 3px;
		text-align: right;
	}
	key {
		font-weight: bold;
		text-decoration: underline;
	}
	.dateDiv {
		font-weight: bold;
		font-size: 11px;
		color: rgb(102,102,102);
	}
	.record > div > div > div {
		padding-bottom: 3px;
	}
	.small_data {
		display: inline;
		font-size: 12px;
	}

</style>
<div id='record_wrapper'>
	<div id='record_top_wrapper'>
		<div id ='record_header'></div>
	</div>
	<ul class="pureCssMenu pureCssMenum" id='right_header'>
		<li id='class_main_menu' class="pureCssMenui0">
			<a class="prevRecords_menu" href="#"><img src="css/images/record_icon.png" width="12px" height='12px'/><span>Record New</span><![if gt IE 6]></a><![endif]><!--[if lte IE 6]><table><tr><td><![endif]-->
			<ul class="pureCssMenum smaller_submenuRecord">
				<li class="pureCssMenui">
					<a class="pureCssMenui prevRecords_menu" href="#" onclick = 'getRecords_generateWindow("newObservation.html")'><span class='nobgimg_menu'>Observation</span><![if gt IE 6]></a><![endif]><!--[if lte IE 6]><table><tr><td><![endif]-->
				</li>
				<!--[if lte IE 6]></td></tr></table></a><![endif]-->
				<li class="pureCssMenui">
					<a class="pureCssMenui prevRecords_menu" href="#" onclick = 'getRecords_generateWindow("newConversation.html")'><span class='nobgimg_menu'>Conversation</span><![if gt IE 6]></a><![endif]><!--[if lte IE 6]><table><tr><td><![endif]-->
				</li>
				<li class="pureCssMenui">
					<a class="pureCssMenui prevRecords_menu" href="#"><span class='nobgimg_menu'>Product</span><![if gt IE 6]></a><![endif]><!--[if lte IE 6]><table><tr><td><![endif]-->
				</li>
			</ul>
			<!--[if lte IE 6]></td></tr></table></a><![endif]-->
		</li>
		<li id='class_main_menu' class="pureCssMenui0">
			<a class="prevRecords_menu" id='view_menu'href="#"><img src="css/images/view_icon.png" width="12px" height='12px'/><span>View</span><![if gt IE 6]></a><![endif]><!--[if lte IE 6]><table><tr><td><![endif]-->
			<ul class="pureCssMenum smaller_submenuView">
				<li class="pureCssMenui">
					<a class="pureCssMenui prevRecords_menu" href="#" onclick='toggleCommunicationsById(0)'><span class='nobgimg_menu'>All</span><![if gt IE 6]></a><![endif]><!--[if lte IE 6]><table><tr><td><![endif]-->
				</li>
				<li class="pureCssMenui">
					<a class="pureCssMenui prevRecords_menu" href="#" onclick='toggleCommunicationsById(1)' ><span class='nobgimg_menu'>Observation</span><![if gt IE 6]></a><![endif]><!--[if lte IE 6]><table><tr><td><![endif]-->
				</li>
				<li class="pureCssMenui">
					<a class="pureCssMenui prevRecords_menu" href="#" onclick='toggleCommunicationsById(2)'><span class='nobgimg_menu'>Conversation</span><![if gt IE 6]></a><![endif]><!--[if lte IE 6]><table><tr><td><![endif]-->
				</li>
				<li class="pureCssMenui">
					<a class="pureCssMenui prevRecords_menu" href="#" onclick='toggleCommunicationsById(3)'><span class='nobgimg_menu'>Product</span><![if gt IE 6]></a><![endif]><!--[if lte IE 6]><table><tr><td><![endif]-->
				</li>
			</ul>
			<!--[if lte IE 6]></td></tr></table></a><![endif]-->
		</li>
		<li class="pureCssMenui0">
			<a id='menu_visible_class' class="prevRecords_menu" href="#" onclick = 'getRecords_generateWindow("graphicalView_dialog.html")'><img src="css/images/graphical_view_icon.png" width="12px" height='12px'/>Graphical View</a>
		</li>
	</ul>
</div>
</div> <div id='record_data_fields'></div>
<script type="text/javascript" charset="utf-8">
	/*
	 * when the page is done loading, loads the selected student's name and the selected class
	 */
	$(document).ready(function() {
		$("#student_list option:selected").each(function() {
			$("#record_header").html($(this).html() + "----------" + $("#menu_visible_class").html());
		});
	});
	function getCommunications() {
		var stid = $("option.std_opt:selected").attr('id');
		//selected student id in the menu
		params.fcn = 'selectAllCommunications';
		//getting communications off server
		params.params = {
			id : stid, //from selected menu item
		}
		$.getJSON(IP + "/mark/model/communications-model.php?callback=?", params, function(data) {
			if(!data[0]) {//standard error checking, etc
				$("#error_text").html(data[1][0]);
				$("#error_msg").show();
				$("#msg").hide();
			} else {
				data = data[1]
				data.sort(function(a, b) {
					return b[6] - a[6]
				})
				for(communication in data) {
					comId = data[communication][0];
					comType = data[communication][3];
					comTypeName = "";
					if(comType == 1) {
						comTypeName = "Observation";
					} else if(comType == 2) {
						comTypeName = "Conversation";
					}
					date = data[communication][6];
					dateTS = date;
					date = new Date(date * 1000);
					dateRead = date.toDateString()
					date = (date.getMonth() + 1) + "/" + date.getDate() + "/" + date.getFullYear();
					expecId = data[communication][7];
					expecTitle = data[communication][5];
					comStyle = data[communication][4];
					comMark = data[communication][2];
					styleName = "";
					styleValue = "";
					if(comStyle == 0) {// true
						styleName = 'Expectation';
					} else if(comStyle == 1) {// false
						styleName = "Learning Skill";
					}
					comData = data[communication][1];
					$("#record_data_fields").append("<div id='record_" + comId + "' class='record' type_id='" + comType + "'></div>")
					html = "<div class = 'record_main'><div class='record_header_info'>";
					html += "<div type_id='" + comType + "'><b>" + comTypeName + "</b></div>";
					html += "<div class='dateDiv'date_string='" + date + "'date='" + dateTS + "'>" + dateRead + "</div>";
					html += "<div expecType = '" + comStyle + "'expec_id='" + expecId + "'>" + styleName + ": <div class='small_data'>" + expecTitle + "</div></div>";
					html += "<div level_id='" + comMark + "'>Level: <div class='small_data'>" + levelIdToName(comMark) + "</div></div>"
					html += "<div class='record_data'>Comments: <div class='small_data'>" + comData + "</div></div>";
					html += "</div></div>";
					html += "<div class = 'record_options'>";
					html += "<div class='record_tool_link_wrapper'><a href='#' class='record_tool_link'id='record_expander_" + comId + "' onclick='expandRecord(" + comId + ")'>Expand</a></div>";
					html += "<div class='record_tool_link_wrapper'><a href='#' class='record_tool_link' editing='0' id='record_editor_" + comId + "'onclick='editRecord(" + comId + ")'>Edit</a></div>";
					html += "<div class='record_tool_link_wrapper'><a href='#' class='record_tool_link' editing='0' id='record_editor_" + comId + "'onclick='deleteRecord(" + comId + ")'>Delete</a></div>";
					html += "</div>";
					$("#record_" + comId + "").append(html);
				}
			} //end if/else statement for selectObservationsAndOrConvos
		});
		//end getJSON function for selectObservationsAndOrConvos
	}//end getCommunications

	function levelIdToName(id) {
		levels = ["Insufficient", "Limited", "Approaching", "Sufficient", "Insightfull"];
		return levels[id];
	}

	/*
	 * generates a new dialog
	 */
	function getRecords_generateWindow(page) {
		$("#dialog").load(page, function() {
			$("#student_list option:selected").each(function() {
				studentsAdded[$(this).attr("id")] = ($(this).html());
				$("#selectedNames").append('<span class="selectedName" id="' + $(this).attr('id') + '">' + $(this).html() + '<a class="remove_link" link_type="std" href="#">Remove</a></span>');
				$("input[value=submit]").after('<span style="display:none" id="shouldTry" try_id="1"></span>')
			});
		});
		$("#dialog").dialog({
			show : "blind",
			hide : "explode",
			position : 'center',
			modal : true,
			height : $(window).height() - 200,
			width : $(window).width() - 300,
			resizable : false,
			close : function(ev, ui) {
				$(this).html("");
			}
		});
	}

	function toggleCommunicationsById(id) {
		$("#record_data_fields").children().each(function() {
			if(id == 0) {
				$(this).show();
			} else {
				if($(this).attr("type_id") != id)
					$(this).hide();
				else {
					$(this).show();
				}
			}
		})
	}

	function expandRecord(id) {
		if($("#record_expander_" + id).html() == "Expand") {
			$("#record_expander_" + id).html("Shrink");
			$("div #record_" + id).children().eq(0).children().eq(0).children().eq(4).css('white-space', 'normal')
		} else if($("#record_expander_" + id).html() == "Shrink") {
			$("#record_expander_" + id).html("Expand");
			$("div #record_" + id).children().eq(0).children().eq(0).children().eq(4).css('white-space', 'nowrap')
		}
	}

	function editRecord(id) {
		// type of record (1 = obs 2 = conv)
		if($("div #record_" + id).attr("type_id") == 1) {
			$("#dialog").load("editObservation.html", function() {
				$("#student_list option:selected").each(function() {// add student
					$("#selectedNames").append('<span class="selectedName" id="' + $(this).attr('id') + '">' + $(this).html() + '</span>');
					//window.location.href = 'getRecords.html?classId='+$("#menu_visible_class").attr("class_id")+'&id='+QueryString.id+'&stdId='+$(this).attr('id');
				});
				// add level
				level = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(3).attr("level_id");
				$("#level_button_group").children().eq(level).click();

				// add expectation
				expectationType = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(2).attr("expectype");
				expectationId = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(2).attr("expec_id");
				expectationText = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(2).html().substr($("div #record_" + id).children().eq(0).children().eq(0).children().eq(2).html().indexOf(":") + 1);
				if(expectationType == 0) {
					expectationsAdded[expectationId] = expectationText
				} else if(expectationType == 1) {
					expectationsAdded[expectationId] = expectationText;
				}
				$("#expList").append("<li><span class='selectedExp' id='" + expectationId + "'>" + expectationText + "</span></li>");
				// get comments
				comments = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(4).children().eq(0).html()
				commentKeys = $(comments);
				commentText = comments.substr(comments.indexOf(":") + 1);
				// "Comments:"
				if(commentText.lastIndexOf("</key>") > -1) {// if keys are present
					commentText = comments.substr(comments.lastIndexOf("</key>") + 6);
				}
				for(var i = 0; i < commentKeys.length; i++) {
					keyLevel = $(commentKeys[i]).attr('type_id');
					if($(commentKeys[i]).attr("type") == "ac") {
						$("#acButtonGroup").children().eq(keyLevel).click()
					} else if($(commentKeys[i]).attr("type") == "work") {
						$("#workButtonGroup").children().eq(keyLevel).click()
					}
				}
				$("#comments_area").html(commentText);
				$("#remainingChars").html(500 - commentText.length);
				//date
				date = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(1).attr('date_string');
				$("#observation_dateField").datepicker("setDate", date);
				$("#addObsButton").attr("onclick", "save(" + id + ")");
				//add onclick with record id to button
			});
			$("#dialog").dialog({
				show : "blind",
				hide : "explode",
				position : 'center',
				modal : true,
				height : $(window).height() - 200,
				width : $(window).width() - 300,
				resizable : false,
				close : function(ev, ui) {
					$(this).html("");
				}
			});
		} else if($("div #record_" + id).attr("type_id") == 2) {
			$("#dialog").load("editConversation.html", function() {
				$("#student_list option:selected").each(function() {// add student
					$("#selectedNames").append('<span class="selectedName" id="' + $(this).attr('id') + '">' + $(this).html() + '</span>');
					//window.location.href = 'getRecords.html?classId='+$("#menu_visible_class").attr("class_id")+'&id='+QueryString.id+'&stdId='+$(this).attr('id');
				});
				// add level
				level = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(3).attr("level_id");
				$("#level_button_group").children().eq(level).click()

				// add expectation
				expectationType = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(2).attr("expectype");
				expectationId = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(2).attr("expec_id");
				expectationText = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(2).html().substr($("div #record_" + id).children().eq(0).children().eq(0).children().eq(2).html().indexOf(":") + 1);
				if(expectationType == 0) {
					expectationsAdded[expectationId] = expectationText
				} else if(expectationType == 1) {
					expectationsAdded[expectationId] = expectationText;
				}
				$("#expList").append("<li><span class='selectedExp' id='" + expectationId + "'>" + expectationText + "</span></li>");
				comments = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(4).children().eq(0).html();
				commentText = comments.substr(comments.indexOf(":") + 1);
				$("#comments_area").html(commentText);
				$("#remainingChars").html(500 - commentText.length);
				date = $("div #record_" + id).children().eq(0).children().eq(0).children().eq(1).attr('date_string');
				$("#observation_dateField").datepicker("setDate", date);
				$("#addObsButton").attr("onclick", "save(" + id + ")");
				//add onclick with record id to button
			});
			$("#dialog").dialog({
				show : "blind",
				hide : "explode",
				position : 'center',
				modal : true,
				height : $(window).height() - 200,
				width : $(window).width() - 300,
				resizable : false,
				close : function(ev, ui) {
					$(this).html("");
				}
			});
		} else {//products

		}
	}

	function deleteRecord(id) {
		params.fcn = "deleteRecord";
		params.params = {
			record : id
		}
		jQuery.getJSON(IP + "/mark/model/communications-model.php?callback=?", params, function(data) {
			if(!data[0]) {
				$("#error_text").html(data[1][0]);
				$("#error_msg").show();
				$("#msg").hide();
			} else {
				$("#record_" + id).remove();
				//get rid of the record on the page so they don't have to refresh
			}
		});
	}


	$(document).ready(function() {
		getCommunications();
	})
</script>